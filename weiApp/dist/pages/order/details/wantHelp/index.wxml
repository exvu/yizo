<view class="run-order-detail">
  <view class="app-toast {{$toast$mask?'app-toast-mask':''}}"  wx:if="{{$toast$show}}">
  <view style="display: inline-block">
    <view class="app-toast-box ">
      <view class="toast-icon">
        <view class="loading" wx:if="{{$toast$icon=='loading'}}">
  <view style="left: 0;top: 0;"/>
  <view style="right: 0;top: 0;animation-delay: .4s;"/>
  <view style=" right: 0;bottom: 0;animation-delay: .8s;"/>
  <view style=" left: 0; bottom: 0;animation-delay: 1.2s;"/>
</view>
        <block wx:else>
          <view class="iconfont icon-{{$toast$icon}}"/>
        </block>
      </view>
      <view class="toast-content">{{$toast$title}}</view>
    </view>
  </view>
</view>
  <view class="detail-top">
    <view class="creater">
      
  <image src="{{$avatar$url?$avatar$url:($avatar$avatarPath+$avatar$id+'.png')}}" class="avatar"/>

      <view class="username iconfont icon-{{detail['creater_gender']==0?'female':'male'}}">{{detail['creater_name']}}</view>
    </view>
    <view class="center">
      <view class="line"/>
      <view class="line"/>
      <view class="time">{{detail['_c']}}</view>
    </view>
    <view class="runner">
      <block wx:if="{{detail['runner']}}">
        
  <image src="{{$avatar$url?$avatar$url:($avatar$avatarPath+$avatar$id+'.png')}}" class="avatar"/>

        <view class="username iconfont icon-{{detail['runner_gender']==0?'female':'male'}}">{{detail['runner_name']}}</view>
      </block>
      <block wx:else>
        <image class="avatar" src="../../../../public/image/runner-default.png"/>
        <view class="username">暂无抢单人</view>
      </block>
    </view>
  </view>
  <view class="detail-content">

    <view class="title">{{detail['title']}}</view>
    <view class="items">
      <view class="item">
        <text class="label">截至时间</text>:
        <text class="text">{{detail['deadline']}}</text>
      </view>
      <view class="item">
        <text class="label">地址</text>:
        <text class="text">{{detail['address']}}</text>
      </view>
      <view class="item">
        <text class="label ">酬劳</text>:
        <text class="text reward" wx:if="{{detail['reward_type']==0}}">{{detail.reward}}</text>
        <text class="text reward reward-money" wx:else>￥{{detail.reward}}</text>
      </view>
      <view class="item">
        <text class="label">详情</text>:
        <text class="text"> {{detail['content']}}</text>
      </view>
    </view>
    <block wx:if="{{detail['gender_constraint']==-1}}">
      <view class="gender_constraint" style="background: #cccccc">不限制</view>
    </block>
    <block wx:elif="{{detail['gender_constraint']==0}}">
      <view class="gender_constraint" style="background: #FF0852">限女生</view>
    </block>
    <block wx:elif="{{detail['gender_constraint']==1}}">
      <view class="gender_constraint" style="background: #1C79FF">限男生</view>
    </block>
  </view>
  <view class="order-status">
    <block wx:if="{{detail['status']>=0}}">
      <view class="iconfont icon-success {{detail['status']>=0?'active':''}}">新订单</view>
      <view class="iconfont icon-success {{detail['status']>=1?'active':''}}">进行中</view>
      <view class="iconfont icon-success {{detail['status']>=4?'active':''}}">已到达</view>
    </block>
    <block wx:else>
      <view class="iconfont icon-warn error">订单已取消</view>
    </block>
  </view>
  <view class="comment-list">
  <view class="comment-top">
    <view class="title">评论(2)</view>
    <view class="add">
      <text class="iconfont icon-edit">写评论</text>
    </view>
  </view>
  <view class="comment-content">
    <block wx:for="{{$comment$list}}" wx:for-index="$comment$index" wx:for-item="$comment$commentItem" wx:key="$comment$key">
      <view class="comment-item">
        
  <image src="{{$comment$avatar$url?$comment$avatar$url:($comment$avatar$avatarPath+$comment$commentItem.creater+'.png')}}" class="avatar"/>

        <view class="content">
            <view class="item">
                <view class="info">
                    <view>
                      <text>{{$comment$commentItem.creater_name}}</text>
                      <block wx:if="{{$comment$detail['creater']==$comment$commentItem.creater}}">
                        <text style="color:#f00;">(主人)</text>
                      </block>
                    </view>
                    <view>{{$comment$commentItem._c}}</view>
                  </view>
                  <view class="comment-text">
                      {{$comment$commentItem.content}}
                  </view>
            </view>
            <block wx:for="{{$comment$commentItem.child}}" wx:for-index="$comment$index" wx:for-item="$comment$childItem" wx:key="$comment$key">
                <view class="item">
                    <view class="info">
                        <view style="color:#f00">主儿回复:</view>
                        <view>{{$comment$commentItem._c}}</view>
                      </view>
                      <view class="comment-text">
                          {{$comment$commentItem.content}}
                      </view>
                </view>
            </block>
        </view>
      </view>
    </block>
  </view>
</view>
  </view>
  <view class="fix-btn">
    <view class="btn" style="width:130rpx;" bindtap="gohome">
      <text class="iconfont icon-setting"/>
      <view class="title">主页</view>
    </view>
    <block  wx:if="{{detail['status']>0 && (detail['creater']==userInfo['id'] || detail['runner']==userInfo['id'])}}">
      <view class="btn" style="width:130rpx;" bindtap="callphone" data-wepy-params-a="{{detail['creater']==userInfo['id']?detail['runner']:detail['phone_number']}}">
        <text class="iconfont icon-setting"/>
        <view class="title">联系</view>
      </view>
    </block>
    <!--取消的订单-->
    <block wx:if="{{detail['status']<0}}">
      <view class="btn" style="flex:1;background:#ccc;color:#fff">
        <view class="title">已取消</view>
      </view>
    </block>
    <block wx:elif="{{detail['status']==4}}">
      <view class="btn" style="flex:1;background:#ccc;color:#fff">
        <view class="title">已完成</view>
      </view>
    </block>
    <!--没有取消的订单-->
    <block wx:else>
      <!-- 创建人-->
      <block wx:if="{{detail['creater']==userInfo['id']}}">
        <view class="btn" style="flex:1;background:#ccc;color:#fff" bindtap="cancelOrder">
          <view class="title">取消求助</view>
        </view>
        <block wx:if="{{detail['status']==0}}">
          <view class="btn" style="flex:1;background:#3385ff;color:#fff" bindtap="editOrder">
            <view class="title">编辑信息</view>
          </view>
        </block>
        <block wx:elif="{{detail['status']==3}}">
          <view class="btn" style="flex:1;background:#3385ff;color:#fff" bindtap="endOrder">
            <view class="title">结单</view>
          </view>
        </block>
      </block>
      <!-- 跑跑-->
      <block wx:elif="{{detail['runner']==userInfo['id']}}">
        <block wx:if="{{detail['status']<3}}">
          <view class="btn" style="flex:1;background:#ccc;color:#fff" bindtap="quitOrder">
            <view class="title">取消跑腿</view>
          </view>
        </block>
        <block wx:if="{{detail['status']==1}}">
          <view class="btn" style="flex:1;background:#3385ff;color:#fff" bindtap="deliverOrder">
            <view class="title">开始送货</view>
          </view>
        </block>
        <block wx:elif="{{detail['status']==2}}">
          <view class="btn" style="flex:1;background:#3385ff;color:#fff" bindtap="finallyOrder">
            <view class="title">已送达</view>
          </view>
        </block>
        <block wx:elif="{{detail['status']==3}}">
          <view class="btn" style="flex:1;background:#ccc;color:#fff">
            <view class="title">等待主人结单</view>
          </view>
        </block>
      </block>
      <!-- 其他-->
      <block wx:else>
        <block wx:if="{{detail['status']==0}}">
          <view class="btn" style="flex:1;background:#3385ff;color:#fff" bindtap="grabOrder">
            <view class="title">立即抢单</view>
          </view>
        </block>
        <block wx:if="{{detail['status']==1 || detail['status']==2}}">
          <view class="btn" style="flex:1;background:#ccc;color:#fff">
            <view class="title">进行中</view>
          </view>
        </block>
      </block>
    </block>
</view>